name: Multi-Job Workflow

on: [push]

jobs:
    build-ubuntu:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up Go environment
              uses: actions/setup-go@v5.5.0
              with:
                  go-version: '1.20'

            - name: Compile the Go file
              run: go build -o main main.go

            - name: Run the compiled binary
              run: ./main

    build-windows:
        runs-on: windows-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up Go environment
              uses: actions/setup-go@v5.5.0
              with:
                  go-version: '1.20'

            - name: Compile the Go file
              run: go build -o main.exe main.go

            - name: Run the compiled binary
              run: .\main.exe

    build-macos:
        runs-on: macos-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up Go environment
              uses: actions/setup-go@v5.5.0
              with:
                  go-version: '1.20'

            - name: Compile the Go file
              run: go build -o main main.go

            - name: Run the compiled binary
              run: ./main

    cross-compile:
        runs-on: ubuntu-latest
        needs: [build-ubuntu, build-windows, build-macos]
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up Go environment
              uses: actions/setup-go@v5.5.0
              with:
                  go-version: '1.20'

            - name: Cross-compile for all platforms
              run: |
                  echo "Cross compiling for all platforms:"
                  GOOS=linux GOARCH=amd64 go build -o main-linux-amd64 main.go
                  GOOS=windows GOARCH=amd64 go build -o main-windows-amd64.exe main.go
                  GOOS=darwin GOARCH=amd64 go build -o main-macos-intel main.go
